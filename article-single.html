    <script src="router.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const header = document.getElementById('header');
            if (header) {
                header.classList.add('scrolled');
            }

            await siteRouter.loadMembers();
            const articles = await fetch('articles.json').then(res => res.json());

            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('id');
            const article = articles.find(a => a.id === articleId);

            if (!article) {
                siteRouter.navigateTo('articles');
                return;
            }

            const updateArticleText = (lang) => {
                document.title = `${article[`title_${lang}`]} - Literary Speaking`;
                document.getElementById('article-category').textContent = article[`category_${lang}`];
                document.getElementById('article-title').textContent = article[`title_${lang}`];
                document.getElementById('article-caption').textContent = article[`image_caption_${lang}`];
                
                const author = siteRouter.members[article.author_id];
                const authorName = author ? author.name : 'Anonymous';
                const articleDate = new Date(article.date).toLocaleDateString(lang.startsWith('es') ? 'es-ES' : 'en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                const metaContainer = document.getElementById('article-meta');
                metaContainer.innerHTML = `
                    <span class="lang-switch" data-en="By" data-es="Por">${lang === 'es' ? 'Por' : 'By'}</span>
                    <a href="#" class="nav-link" data-page-id="member" data-member-id="${article.author_id}">${authorName}</a>
                    <span>â€¢</span>
                    <span>${articleDate}</span>
                `;

                const contentContainer = document.getElementById('article-content');
                const formattedContent = article[`content_${lang}`]
                    .split(/\n\n/)
                    .map(p => `<p>${p.replace(/\n/g, '<br>')}</p>`)
                    .join('');
                contentContainer.innerHTML = formattedContent;

                document.querySelectorAll('.nav-link').forEach(link => {
                    if(link.closest('#article-meta') || link.classList.contains('back-link')) {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            siteRouter.navigateTo(link.dataset.pageId, link.dataset.memberId);
                        });
                    }
                });
            };
            
            document.getElementById('article-image').src = article.image;
            document.getElementById('article-image').alt = article.title_en;

            const initialLang = localStorage.getItem('language') || 'en';
            updateArticleText(initialLang);

            const langObserver = new MutationObserver(() => updateArticleText(document.documentElement.lang));
            langObserver.observe(document.documentElement, { attributes: true, attributeFilter: ['lang'] });
        });
    </script>
