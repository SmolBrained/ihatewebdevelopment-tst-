<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://i.imgur.com/WPy5YDY.png">
    <title>News | Literary Speaking</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .hero-banner{height:60vh;min-height:400px;display:flex;align-items:center;justify-content:center;color:#fff;text-align:center;position:relative;padding:0 20px;background-image:url(https://i.imgur.com/p6BgTSq.png);background-attachment:fixed;background-position:center;background-repeat:no-repeat;background-size:cover}
        .hero-banner .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:2}
        .hero-banner .content{position:relative;z-index:3}
        .hero-banner h1{font-size:3.8rem;font-weight:900;margin:0;line-height:1.2}
        
        .news-layout { display: grid; grid-template-columns: 2fr 1.2fr; gap: 40px; }
        .main-column, .sidebar-column { text-align: left; }
        .main-column { border-top: 1px solid #ddd; }
        .news-item { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: center; padding: 30px 0; border-bottom: 1px solid #ddd; text-decoration: none; color: inherit; }
        .news-item-title { font-size: 1.8rem; font-weight: 900; margin: 0 0 10px; line-height: 1.2; transition: color 0.3s ease; }
        .news-item:hover .news-item-title { color: var(--color-purple-dark); }
        .news-item-excerpt { font-size: 1rem; line-height: 1.6; color: var(--color-text-light); margin: 0 0 10px; }
        .news-item-meta { font-size: 0.8rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; }
        .news-item-image { width: 100%; aspect-ratio: 16/10; object-fit: cover; border-radius: 8px; }

        .sidebar-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .sidebar-item { border: 1px solid #eee; padding: 15px; text-decoration: none; color: inherit; border-radius: 8px; transition: box-shadow 0.3s ease; }
        .sidebar-item:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.07); }
        .sidebar-item-author { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: var(--color-text-muted); margin: 0 0 10px; }
        .sidebar-item-title { font-size: 1.1rem; font-weight: 900; margin: 0 0 10px; line-height: 1.3; }
        .sidebar-item-meta { font-size: 0.8rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; }

        @media (max-width: 900px) { .news-layout { grid-template-columns: 1fr; } }
        @media (max-width: 768px) {
            .hero-banner{background-attachment:scroll;}
            .hero-banner h1{font-size:2.2rem;}
            .news-item { grid-template-columns: 1fr; }
            .news-item-image { grid-row: 1; margin-bottom: 20px; }
            .news-item-title { font-size: 1.5rem; }
            .sidebar-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-current-page="news">
    <header class="site-header" id="header"></header>
    <main>
        <section class="hero-banner">
            <div class="overlay"></div>
            <div class="content scroll-animated">
                <h1 class="lang-switch" data-en="News" data-es="Noticias"></h1>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <div id="news-layout" class="news-layout">
                    <div id="main-column" class="main-column"></div>
                    <div id="sidebar-column" class="sidebar-column"><div id="sidebar-grid" class="sidebar-grid"></div></div>
                </div>
            </div>
        </section>
    </main>
    <footer class="site-footer"></footer>
    <script src="router.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD0qVihpuLI0cF0PZ32o8tFBLfTgjlqB6A",
            authDomain: "literary-speaking.firebaseapp.com",
            projectId: "literary-speaking",
            storageBucket: "literary-speaking.appspot.com",
            messagingSenderId: "699059463612",
            appId: "1:699059463612:web:ecb2e784d627c6b93937b9",
            measurementId: "G-0L1V3XXGGR"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', async () => {
            await siteRouter.loadMembers();
            const newsQuery = query(collection(db, "news"), orderBy("date", "desc"));
            const querySnapshot = await getDocs(newsQuery);
            const allNewsItems = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            const featuredItems = allNewsItems.filter(item => item.isFeatured);
            const sidebarItems = allNewsItems.filter(item => !item.isFeatured);

            const mainColumn = document.getElementById('main-column');
            const sidebarGrid = document.getElementById('sidebar-grid');

            const populateColumns = (lang) => {
                if (!mainColumn || !sidebarGrid) return;
                mainColumn.innerHTML = '';
                sidebarGrid.innerHTML = '';

                if (allNewsItems.length === 0) {
                    mainColumn.innerHTML = `<p class="lang-switch" data-en="No news items yet. Check back soon!" data-es="Aún no hay noticias. ¡Vuelve pronto!"></p>`;
                    siteRouter.applyLanguage(lang);
                    return;
                }

                featuredItems.forEach(item => {
                    const link = document.createElement('a');
                    link.className = 'news-item';
                    link.href = `news-single.html?id=${item.id}`;
                    link.innerHTML = `
                        <div class="news-item-content">
                            <h3 class="news-item-title">${item[`title_${lang}`]}</h3>
                            <p class="news-item-excerpt">${item[`excerpt_${lang}`]}</p>
                            <p class="news-item-meta">${item[`read_time_${lang}`]}</p>
                        </div>
                        <img src="${item.thumbnail_url || 'https://i.imgur.com/3Yj6bA1.png'}" alt="" class="news-item-image">
                    `;
                    mainColumn.appendChild(link);
                });

                sidebarItems.forEach(item => {
                    const author = siteRouter.members[item.author_id] || { name: 'Anonymous' };
                    const link = document.createElement('a');
                    link.className = 'sidebar-item';
                    link.href = `news-single.html?id=${item.id}`;
                    link.innerHTML = `
                        <p class="sidebar-item-author">${author.name}</p>
                        <h4 class="sidebar-item-title">${item[`title_${lang}`]}</h4>
                        <p class="sidebar-item-meta">${item[`read_time_${lang}`]}</p>
                    `;
                    sidebarGrid.appendChild(link);
                });
            };

            const initialLang = localStorage.getItem('language') || 'en';
            populateColumns(initialLang);

            const langObserver = new MutationObserver(() => {
                populateColumns(document.documentElement.lang);
            });
            langObserver.observe(document.documentElement, { attributes: true, attributeFilter: ['lang'] });
        });
    </script>
</body>
</html>
